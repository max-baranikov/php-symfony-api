services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: true

    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'
            - '../src/Application/**/{DTO,Entity,ValueObject}/*'
            - '../src/Domain/**/{DTO,Entity,ValueObject}/*'

    App\Infrastructure\Http\Controller\:
        resource: '../src/Infrastructure/Http/Controller/'
        public: true
        tags: ['controller.service_arguments']

    App\Domain\Product\Policies\:
        resource: '../src/Domain/Product/Policies/'
        tags: ['app.discount_policy']

    App\Infrastructure\Persistence\Doctrine\ProductRepository:
        arguments:
            $entityManager: '@doctrine.orm.entity_manager'

    App\Application\ListProducts\ListProductsHandler:
        arguments:
            # $productRepository: '@App\Infrastructure\Persistence\Doctrine\ProductRepository'
            $discountPolicies: !tagged_iterator app.discount_policy

    App\Infrastructure\Http\Controller\ProductController:
        arguments:
            $listProductsHandler: '@App\Application\ListProducts\ListProductsHandler'